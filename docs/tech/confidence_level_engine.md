# 技術設計：確信レベル（Confidence Level）エンジン

## 1. 目的
AI開発における「なんとなく（バイブス）」を数値化し、開発者に「確信」の状態を視覚的に提示する。不十分な場合は改善ヒントを与え、品質の規律を強制する。

## 2. アーキテクチャ

### 2.1 判定プロセス
1.  **入力取得**: ユーザーからのプロンプト、参照されているSSOT、既存コードの文脈を取得。
2.  **多重監査（Reviewer）**: 
    - `reviewer` ロールが `ssot/governance.yml` の基準に基づき、1〜3 のレベルを判定。
    - 判定理由（不足している要素）を構造化データとして出力。
3.  **UI への反映**:
    - **プログレスバー**: 現在の確信レベルを視覚化（1=赤、2=黄、3=青）。
    - **改善ヒント**: レベル 3 に到達するために必要な具体的なアクション（「エンティティ A のバリデーションが未定義です」等）を表示。
    - **Before/After プレビュー**: 修正前後の「仕様の整い具合」を比較提示。

### 2.2 データ構造（Reviewer 出力形式）
```json
{
  "confidence_level": 1 | 2 | 3,
  "label": "漂う開発（バイブス）",
  "missing_elements": [
    {
      "type": "ssot_reference",
      "target": "ssot/platform.yml",
      "message": "組織IDのバリデーションルールが参照されていません。"
    }
  ],
  "improvement_hint": "ssot/platform.yml を読み込ませるか、バリデーション仕様を明文化してください。",
  "before_after_comparison": {
    "before": "抽象的な『登録機能』の指示",
    "after": "SSOTに準拠した『UUID/Email重複チェック付き登録機能』"
  }
}
```

## 3. 実装ステップ（Phase 2）

1.  **プロンプトテンプレートの更新**: `ssot/prompt_templates.yml` に確信レベル判定用の思考フレームワークを追加。
2.  **判定ロジックの統合**: `lib/workflow-engine.ts` の `reviewer` ステップで、この構造化データを解析・保存するように拡張。
3.  **UI コンポーネント作成**: `ConfidenceProgressBar.tsx` を作成し、Web コンソールのワークフロー実行画面に統合。

## 4. マーケティング的価値
「バイブス度が高いです」と叱るのではなく、「あと 2 つの知恵を整えれば、確信を持って実装できます」と導くことで、ユーザーに **「dev-OS を使えば失敗しない」という成功体験** を提供する。

